<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wild Hunt ARG</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: url("https://i.imgur.com/KPuH1fc.jpeg") center center fixed;
      background-size: cover;
      font-family: "MS Sans Serif", Tahoma, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .win-window {
      width: 320px;
      background: #C0C0C0;
      border: 2px solid #808080;
      box-shadow: inset -1px -1px 0 #fff, inset 1px 1px 0 #000;
    }

    .title-bar {
      background: #000080;
      color: #fff;
      padding: 4px 6px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title-bar-text {
      flex-grow: 1;
    }

    .close-btn {
      width: 18px;
      height: 18px;
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      background: #800000;
      border: 2px outset #C0C0C0;
      text-align: center;
      line-height: 14px;
      cursor: pointer;
    }

    .window-body {
      padding: 16px;
    }

    label, p {
      margin: 8px 0 4px;
      font-size: 13px;
    }

    input[type="password"], input[type="text"] {
      width: 100%;
      padding: 4px;
      border: 2px solid #808080;
      box-shadow: inset -1px -1px 0 #fff, inset 1px 1px 0 #000;
      background: #fff;
      font-size: 13px;
    }

    .btn-row {
      margin-top: 12px;
      text-align: right;
    }

    button.action-btn {
      min-width: 70px;
      padding: 2px 6px;
      font-size: 13px;
      border: 2px solid #808080;
      box-shadow: inset -1px -1px 0 #fff, inset 1px 1px 0 #000;
      background: #C0C0C0;
      cursor: pointer;
    }

    #error-msg, #save-msg, #returning-msg, #stage1-msg {
      color: #800000;
      height: 14px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="win-window">
    <div class="title-bar">
      <div class="title-bar-text">Wild Hunt ARG</div>
      <div class="close-btn" onclick="returnToLogin()">X</div>
    </div>
    <div class="window-body">

      <div id="login-pane">
        <p>Enter Your Password</p>
        <label for="pw">Password</label>
        <input type="password" id="pw" autocomplete="off" />
        <div class="btn-row">
          <button class="action-btn" onclick="checkPassword()">OK</button>
        </div>
        <p>or Resume Your Progress</p>
        <label for="loginId">Student ID</label>
        <input type="text" id="loginId" autocomplete="off" />
        <div class="btn-row">
          <button class="action-btn" onclick="resumeProgress()">Resume</button>
        </div>
        <div id="error-msg"></div>
        <div id="returning-msg"></div>
      </div>

      <div id="register-pane" style="display:none">
        <p><strong>Welcome New User</strong></p>
        <p>Doesn’t look like we’ve met before. Let’s get acquainted.</p>
        <label for="sid">Student ID Number</label>
        <input type="text" id="sid" autocomplete="off" />
        <label for="fname">First Name</label>
        <input type="text" id="fname" autocomplete="off" />
        <div class="btn-row">
          <button class="action-btn" onclick="saveProgress()">OK</button>
        </div>
        <div id="save-msg"></div>
      </div>

      <div id="stage1-box" style="display:none">
        <p><strong>Stage 1</strong></p>
        <p>“I have keys but no locks. I have space but no room. You can enter but can’t go outside. What am I?”</p>
        <label for="stage2pw">Answer</label>
        <input type="text" id="stage2pw" autocomplete="off" />
        <div class="btn-row">
          <button class="action-btn" onclick="checkStage2Password()">Submit</button>
        </div>
        <div id="stage1-msg"></div>
      </div>

    </div>
  </div>

  <script>
    const STAGE1_PASSWORD = "whiterabbit";
    const STAGE2_PASSWORD = "keyboard";
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbyV3iRpKNCbf9_2LFrPGeKDwdLtArgA9QRi6zOHNvorFdwETMpw6JO_hVmhdyphHcHv/exec";

    function checkPassword() {
      const pw = document.getElementById("pw").value.trim().toLowerCase();
      const err = document.getElementById("error-msg");
      if (pw === STAGE1_PASSWORD) {
        document.getElementById("login-pane").style.display = "none";
        document.getElementById("register-pane").style.display = "block";
        err.textContent = "";
      } else {
        err.textContent = "Incorrect password. Try again.";
      }
    }

    function saveProgress() {
      const sid = document.getElementById("sid").value.trim();
      const fname = document.getElementById("fname").value.trim();
      const msg = document.getElementById("save-msg");
      if (!sid || !fname) { msg.textContent = "All fields are required."; return; }
      msg.textContent = "Saving…";

      fetch(ENDPOINT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ sid, fname, stage: "Stage 1" })
      })
      .then(r => r.text())
      .then(t => {
        if (t === "Success") {
          document.getElementById("register-pane").style.display = "none";
          document.getElementById("stage1-box").style.display = "block";
        } else {
          msg.textContent = "Error saving. Try again.";
        }
      })
      .catch(() => { msg.textContent = "Network error."; });
    }

    function resumeProgress() {
      const sid = document.getElementById("loginId").value.trim();
      const msg = document.getElementById("returning-msg");
      if (!sid) { msg.textContent = "Student ID required."; return; }
      msg.textContent = "Checking…";

      fetch(ENDPOINT_URL + "?sid=" + encodeURIComponent(sid))
        .then(r => r.json())
        .then(data => {
          if (data.status === "found") {
            msg.textContent = "Welcome back, " + data.name + "!";
            routeToStage(data.stage);
          } else {
            msg.textContent = "ID not found.";
          }
        })
        .catch(() => { msg.textContent = "Network error."; });
    }

    function routeToStage(stage) {
      document.getElementById("login-pane").style.display = "none";
      document.getElementById("register-pane").style.display = "none";
      document.getElementById("stage1-box").style.display = "none";
      if (stage === "Stage 1") {
        document.getElementById("stage1-box").style.display = "block";
      }
    }

    function checkStage2Password() {
      const pw = document.getElementById("stage2pw").value.trim().toLowerCase();
      const msg = document.getElementById("stage1-msg");
      if (pw === STAGE2_PASSWORD) {
        msg.textContent = "Correct. Stage 2 unlocked (coming soon).";
      } else {
        msg.textContent = "Wrong password. Try again.";
      }
    }

    function returnToLogin() {
      document.getElementById("login-pane").style.display = "block";
      document.getElementById("register-pane").style.display = "none";
      document.getElementById("stage1-box").style.display = "none";
      ["error-msg", "save-msg", "stage1-msg", "returning-msg"].forEach(id => document.getElementById(id).textContent = "");
    }
  </script>
</body>
</html>
